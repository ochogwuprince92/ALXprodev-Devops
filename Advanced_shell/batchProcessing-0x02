# #!/bin/bash

# # Create output directory if it doesn't exist
# mkdir -p pokemon_data

# # List of Pokémon (all lowercase for API)
# pokemon_list=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

# for name in "${pokemon_list[@]}"; do
#     echo "Fetching data for $name..."

#     # Fetch from API and save to json file
#     response=$(curl -s -w "%{http_code}" -o "pokemon_data/${name}.json" "https://pokeapi.co/api/v2/pokemon/${name}")

#     # Check if response code is 200 (OK)
#     if [ "$response" -eq 200 ]; then
#         echo "Saved data to pokemon_data/${name}.json ✅"
#     else
#         echo "Failed to fetch data for $name ❌ (HTTP $response)" >> errors.txt
#         rm -f "pokemon_data/${name}.json"  # Remove incomplete file
#     fi

#     # Wait 2 seconds to avoid rate-limiting
#     sleep 2
# done

#!/bin/bash

POKEMONS=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")
DATA_DIR="pokemon_data"
LOG_FILE="fetch_errors.log"

mkdir -p "$DATA_DIR"
: > "$LOG_FILE"  # clear log file before each run

for pokemon in "${POKEMONS[@]}"; do
    echo "Fetching data for $pokemon..."

    success=false
    attempt=1

    while [ $attempt -le 3 ]; do
        response=$(curl -s -w "%{http_code}" -o "$DATA_DIR/$pokemon.json" "https://pokeapi.co/api/v2/pokemon/$pokemon")

        if [[ $response == 200 ]]; then
            echo "Saved data to $DATA_DIR/$pokemon.json ✅"
            success=true
            break
        else
            echo "Attempt $attempt failed for $pokemon (HTTP $response). Retrying..."
            sleep 2
            attempt=$((attempt + 1))
        fi
    done

    if ! $success; then
        echo "❌ Failed to fetch data for $pokemon after 3 attempts. Logging error."
        echo "$pokemon fetch failed after 3 attempts." >> "$LOG_FILE"
        rm -f "$DATA_DIR/$pokemon.json"  # remove incomplete file if any
    fi

    sleep 1  # delay to avoid rate-limiting
done

echo ""
if [ -s "$LOG_FILE" ]; then
    echo "Some Pokémon failed. Check $LOG_FILE for details."
else
    echo "All Pokémon data fetched successfully. ✅"
fi
