#!/bin/bash

# Create the CSV file and write header
report_file="pokemon_report.csv"
echo "Name,Height (m),Weight (kg)" > "$report_file"

# Loop through all JSON files in pokemon_data
for file in pokemon_data/*.json; do
    # Use jq to extract data
    name=$(jq -r '.name' "$file" | sed 's/.*/\u&/')  # Capitalize name
    height_dm=$(jq -r '.height' "$file")  # in decimeters
    weight_hg=$(jq -r '.weight' "$file")  # in hectograms

    # Convert to meters and kilograms (bash floating-point)
    height_m=$(awk "BEGIN {printf \"%.2f\", $height_dm / 10}")
    weight_kg=$(awk "BEGIN {printf \"%.2f\", $weight_hg / 10}")

    # Write to CSV
    echo "$name,$height_m,$weight_kg" >> "$report_file"
done

# Display report path
echo "CSV Report generated at: $report_file"
echo ""

# Show report content
cat "$report_file"

echo ""

# Calculate and print averages
awk -F, '
NR > 1 {
    height += $2
    weight += $3
    count++
}
END {
    avg_height = height / count
    avg_weight = weight / count
    printf "\nAverage Height: %.2f m\n", avg_height
    printf "Average Weight: %.2f kg\n", avg_weight
}
' "$report_file"
